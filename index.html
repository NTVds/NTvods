<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NTvods - Pedido</title>
  <style>
    body {
      background-color: #0e0e0e;
      color: #ffffff;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      background-color: #1c1c1c;
      color: #fff;
      border: 1px solid #444;
      border-radius: 5px;
    }
    img {
      width: 100px;
      border-radius: 8px;
      margin-top: 10px;
    }
    .item {
      cursor: pointer;
      margin: 10px 0;
    }
    .item:hover {
      background-color: #222;
    }
  </style>
</head>
<body>

  <h1>Fazer Pedido</h1>
  
  <input type="text" id="nome" placeholder="Seu nome (opcional)"/>
  <input type="text" id="busca" placeholder="Buscar filme ou série..."/>
  
  <div id="resultados"></div>

  <textarea id="observacoes" placeholder="Observações extras"></textarea>
  <button onclick="enviarPedido()">Enviar Pedido</button>

  <script>
    let tmdbId = '';
    let imagem = '';
    let tipo = '';

    const resultados = document.getElementById('resultados');
    const apiKey = 'eb93e716b56767d9b0e6d4fdcf25a511';

    document.getElementById('busca').addEventListener('input', function () {
      const query = this.value;
      if (query.length < 3) return;
      fetch(`https://api.themoviedb.org/3/search/multi?api_key=${apiKey}&language=pt-BR&query=${encodeURIComponent(query)}`)
        .then(res => res.json())
        .then(data => {
          resultados.innerHTML = '';
          data.results.forEach(item => {
            const nome = item.title || item.name;
            const tipoItem = item.media_type === 'tv' ? 'Série' : 'Filme';
            const imagemUrl = item.poster_path ? `https://image.tmdb.org/t/p/w200${item.poster_path}` : '';
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `<strong>${nome}</strong> - ${tipoItem}<br/>${imagemUrl ? `<img src="${imagemUrl}"/>` : ''}`;
            div.onclick = () => {
              tmdbId = item.id;
              imagem = imagemUrl;
              tipo = tipoItem;
              resultados.innerHTML = `<p>Selecionado: <strong>${nome}</strong> (${tipo})</p>${imagemUrl ? `<img src="${imagemUrl}"/>` : ''}`;
            };
            resultados.appendChild(div);
          });
        });
    });

    function enviarPedido() {
      const nome = document.getElementById('nome').value;
      const observacoes = document.getElementById('observacoes').value;

      if (!tmdbId) {
        alert('Selecione um filme ou série antes de enviar.');
        return;
      }

      fetch('https://script.google.com/macros/s/AKfycbz9qmaA1ZJfJItuMNyEo5-_25vqW-ly3GNz38ubhLEn2dkfO-kFD36UEK-wJG4uPGJorg/exec', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          nome,
          tipo,
          observacoes,
          tmdbId,
          imagem
        })
      })
      .then(response => response.json())
      .then(data => {
        alert("Pedido enviado com sucesso!");
        window.location.href = data.redirecionamento;
      })
      .catch(err => {
        alert("Erro ao enviar pedido.");
        console.error(err);
      });
    }
  </script>
</body>
</html>
